# ==================================================
# Шпаргалка по командам для управления ботом на сервере
# ==================================================

# ---
# 1. Первоначальная настройка сервера (выполняется один раз)
# ---

# Создание нового пользователя (более безопасно, чем работать под root)
# Вместо 'almaz' можно использовать любое имя.
adduser almaz

# Добавление нового пользователя в группу 'sudo' (дает права администратора)
usermod -aG sudo almaz

# Подключение к серверу по SSH под новым пользователем
# Вместо 'almaz' - имя вашего пользователя, вместо IP - адрес вашего сервера.
ssh almaz@144.31.120.36

# Обновление системы и установка ПО (Git и Docker)
sudo apt update && sudo apt upgrade -y && sudo apt install git docker.io -y

# Добавление вашего пользователя в группу 'docker', чтобы не писать 'sudo' каждый раз
# ВАЖНО: после этой команды нужно выйти с сервера (exit) и зайти снова.
sudo usermod -aG docker almaz


# ---
# 2. Развертывание бота (выполняется один раз)
# ---

# Клонирование проекта с GitHub
git clone https://github.com/Almazziastinov/treiding_bot.git

# Переход в папку проекта
cd treiding_bot

# Сборка Docker-образа из Dockerfile. Точка в конце обязательна!
# 'trading-bot' - это имя, которое мы даем нашему образу.
docker build -t trading-bot .

# Запуск контейнера с ботом.
# ВАЖНО: Замените ВАШ_ТОКЕН на реальный токен.
docker run -d --restart always --name my-trading-bot -e BOT_TOKEN="ВАШ_ТОКЕН" trading-bot


# ---
# 3. Управление запущенным ботом
# ---

# Посмотреть список запущенных контейнеров
docker ps

# Посмотреть логи бота (что он выводит в консоль)
docker logs my-trading-bot

# Посмотреть логи в реальном времени (нажмите Ctrl+C для выхода)
docker logs -f my-trading-bot

# Остановить бота
docker stop my-trading-bot

# Запустить бота снова (если был остановлен)
docker start my-trading-bot

# Удалить контейнер (нужно сначала его остановить)
docker rm my-trading-bot


# ---
# 4. Обновление кода бота
# ---

# 1. Зайдите на сервер и перейдите в папку проекта
# cd treiding_bot

# 2. Скачайте последние изменения с GitHub
git pull

# 3. Пересоберите образ с новым кодом
docker build -t trading-bot .

# 4. Остановите и удалите старый контейнер
docker stop my-trading-bot
docker rm my-trading-bot

# 5. Запустите новый контейнер с обновленным кодом (команда та же, что и при первом запуске)
# docker run -d --restart always --name my-trading-bot -e BOT_TOKEN="ВАШ_ТОКЕН" trading-bot
